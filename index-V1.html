<! DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="å¤šå¸ç§æƒè¯æ”¶ç›Šä¼°ç®—å™¨ - å®æ—¶æ±‡ç‡è½¬æ¢ï¼Œæ™ºèƒ½æ”¶ç›Šè®¡ç®—">
    <meta name="theme-color" content="#4338CA">
    <title>MWE | å¤šå¸ç§æƒè¯æ”¶ç›Šä¼°ç®—å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter: wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“ˆ</text></svg>">
   Â 
    <style>
        /* ===== é‡ç½®ä¸åŸºç¡€æ ·å¼ ===== */
        * {
            margin:  0;
            padding: 0;
            box-sizing:  border-box;
        }

        html {
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background:  linear-gradient(135deg, #F8FAFC 0%, #F1F5F9 100%);
            min-height: 100vh;
            padding: 1rem;
            color: #1E293B;
            line-height: 1.6;
        }

        . container {
            max-width:  720px;
            margin: 0 auto;
        }

        /* ===== å¤´éƒ¨åŒºåŸŸ ===== */
        .calc-header {
            text-align: center;
            margin-bottom: 1.5rem;
            padding:  1.5rem 1. 2rem;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 1rem;
            border: 1px solid rgba(226, 232, 240, 0.6);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.03);
            position: relative;
        }

        /* è¯­è¨€åˆ‡æ¢æŒ‰é’® */
        .lang-switch {
            position: absolute;
            right: 1.2rem;
            top: 1.2rem;
            padding: 0.5rem 0.9rem;
            border-radius: 0.5rem;
            background: #fff;
            border: 1px solid #E2E8F0;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            z-index: 10;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            font-weight: 600;
        }

        .lang-switch:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-color: #4338CA;
        }

        .lang-switch: active {
            transform: translateY(0);
        }

        /* æ ‡é¢˜æ ·å¼ */
        .calc-header h1 {
            font-size: 1.5rem;
            font-weight:  700;
            margin-bottom: 0.8rem;
            letter-spacing: -0.02em;
        }

        .calc-header h1 .zh-title {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.6rem;
            background: linear-gradient(120deg, #4338CA, #0EA5E9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .calc-header h1 .en-title {
            font-size: 0.85rem;
            font-weight:  500;
            opacity: 0.7;
            margin-top: 0.3rem;
            color: #64748B;
        }

        /* MWE å¾½ç«  */
        .mwe-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #4338CA, #0EA5E9);
            color: white;
            font-weight: 800;
            font-size: 0.7rem;
            padding: 0.2rem 0.55rem;
            border-radius:  0.3rem;
            letter-spacing: 0.05em;
            box-shadow: 0 2px 8px rgba(67, 56, 202, 0.2);
            flex-shrink: 0;
        }

        /* ç‰¹æ€§æ ‡ç­¾ç»„ */
        .feature-tags {
            display: flex;
            justify-content: center;
            gap: 0.8rem;
            margin-top: 0.8rem;
            flex-wrap:  wrap;
        }

        . feature-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.75rem;
            color: #4338CA;
            padding: 0.35rem 0.7rem;
            border-radius:  0.4rem;
            background: linear-gradient(135deg, rgba(67, 56, 202, 0.08), rgba(14, 165, 233, 0.08));
            border: 1px solid rgba(67, 56, 202, 0.2);
            font-weight: 500;
            transition: all 0.2s ease;
        }

        . feature-tag:hover {
            background: linear-gradient(135deg, rgba(67, 56, 202, 0.12), rgba(14, 165, 233, 0.12));
            transform: translateY(-2px);
        }

        . feature-tag i {
            font-size: 0.75rem;
            color: #4338CA;
        }

        /* ===== åŸºç¡€é€‰å‹åŒº ===== */
        .base-selector {
            background: #fff;
            border-radius: 1rem;
            padding: 1.2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            margin-bottom: 1rem;
            border: 1px solid #E2E8F0;
            transition: all 0.2s ease;
        }

        .base-selector:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            border-color: #D0D9E8;
        }

        .section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #4338CA;
            margin-bottom: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        . section-title i {
            color: #4338CA;
            font-size:  0.85rem;
        }

        /* é€‰æ‹©å™¨ç½‘æ ¼ */
        .selector-grid {
            display: grid;
            grid-template-columns:  repeat(3, 1fr);
            gap: 0.8rem;
            margin-bottom: 0.8rem;
        }

        .selector-item {
            display: flex;
            flex-direction: column;
        }

        .selector-item . item-label {
            font-size: 0.75rem;
            color: #64748B;
            font-weight: 600;
            margin-bottom: 0.3rem;
            display: flex;
            align-items: center;
            gap:  0.2rem;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        . selector-input {
            width: 100%;
            padding:  0.7rem 0.6rem;
            border: 1. 5px solid #E2E8F0;
            border-radius: 0.6rem;
            font-size:  0.85rem;
            background: #F8FAFC;
            transition: all 0.2s ease;
            height: 2. 6rem;
            font-weight: 500;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2364748B' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.6rem center;
            background-size: 1.2em;
            padding-right: 2. 4rem;
        }

        .selector-input:hover {
            border-color: #CBD5E1;
            background-color: #F1F5F9;
        }

        .selector-input:focus {
            outline: none;
            border-color: #4338CA;
            box-shadow:  0 0 0 3px rgba(67, 56, 202, 0.1);
            background-color: #fff;
        }

        /* æ±‡ç‡æç¤º */
        .rate-update-hint {
            font-size: 0.75rem;
            color: #94A3B8;
            padding: 0.7rem 0.8rem;
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.04), rgba(67, 56, 202, 0.04));
            border-radius: 0.5rem;
            border-left: 3px solid #0EA5E9;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 500;
        }

        . rate-time {
            color: #0EA5E9;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }

        /* ===== è®¡ç®—åŒºå— ===== */
        . calc-section {
            background: #fff;
            border-radius: 1rem;
            padding: 1.2rem;
            box-shadow:  0 2px 8px rgba(0, 0, 0, 0.04);
            margin-bottom: 1rem;
            border: 1px solid #E2E8F0;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .calc-section:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            border-color: #D0D9E8;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 0.3rem 0;
            transition: all 0.2s ease;
            user-select: none;
        }

        .section-header:hover . title {
            color: #2563EB;
        }

        .section-header . title {
            font-size:  0.95rem;
            font-weight:  600;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.2s ease;
        }

        .section-header .toggle-btn {
            font-size: 0.75rem;
            color: #94A3B8;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.3rem 0.5rem;
            border-radius:  0.3rem;
            background: #F1F5F9;
            transition: all 0.2s ease;
        }

        .section-header:hover .toggle-btn {
            background: #E2E8F0;
        }

        .section-content {
            display: none;
            margin-top: 1rem;
            animation: slideDown 0.3s ease;
        }

        .section-content.expanded {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform:  translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== è¾“å…¥å­—æ®µ ===== */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        . input-group {
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .input-label {
            font-size: 0.75rem;
            color: #64748B;
            font-weight: 600;
            margin-bottom: 0.3rem;
            display: flex;
            align-items: center;
            gap: 0.2rem;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .input-label i {
            font-size: 0.7rem;
        }

        .input-wrapper {
            position: relative;
            width: 100%;
        }

        .currency-tag {
            position: absolute;
            right: 0.8rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.75rem;
            color: #94A3B8;
            pointer-events: none;
            font-weight: 600;
            letter-spacing: 0.05em;
            transition: all 0.2s ease;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 2. 5rem 0.75rem 0.85rem;
            border: 1.5px solid #E2E8F0;
            border-radius: 0.6rem;
            font-size: 0.85rem;
            background: #F8FAFC;
            transition: all 0.2s ease;
            height: 2.6rem;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
        }

        .form-input. no-currency {
            padding-right: 0.85rem;
        }

        . form-input:hover {
            border-color: #CBD5E1;
            background-color: #F1F5F9;
        }

        . form-input:focus {
            outline: none;
            border-color: #4338CA;
            box-shadow: 0 0 0 3px rgba(67, 56, 202, 0.1);
            background-color: #fff;
        }

        .form-input:focus + .currency-tag {
            color: #4338CA;
        }

        .form-input:: placeholder {
            color: #CBD5E1;
        }

        . input-hint {
            font-size: 0.7rem;
            color: #94A3B8;
            margin-top: 0.2rem;
            font-style: italic;
        }

        /* ===== æŒ‰é’®ç»„ ===== */
        . btn-group {
            display:  flex;
            gap: 0.8rem;
            margin:  1rem 0 1. 2rem 0;
        }

        .calc-btn {
            flex: 1;
            padding:  0.8rem 0;
            border-radius: 0.6rem;
            font-size: 0.85rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            transition: all 0.2s ease;
            height: 2.8rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            position: relative;
            overflow: hidden;
            user-select: none;
        }

        .calc-btn:: before {
            content: '';
            position: absolute;
            top: 0;
            left:  -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.3s ease;
            pointer-events: none;
        }

        .calc-btn:hover::before {
            left: 100%;
        }

        . btn-primary {
            background: linear-gradient(120deg, #4338CA, #0EA5E9);
            color: #fff;
            box-shadow: 0 4px 12px rgba(67, 56, 202, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(67, 56, 202, 0.4);
        }

        .btn-primary: active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #F8FAFC;
            color:  #4338CA;
            border: 1.5px solid #E2E8F0;
        }

        .btn-secondary:hover {
            background: #F1F5F9;
            border-color: #CBD5E1;
            transform: translateY(-2px);
        }

        .btn-secondary:active {
            transform: translateY(0);
        }

        /* ===== ç»“æœåŒº ===== */
        .result-section {
            background: linear-gradient(135deg, #fff 0%, #F8FAFC 100%);
            border-radius: 1rem;
            padding: 1.2rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            border: 1.5px solid #0EA5E9;
            display: none;
            animation: slideUp 0.4s ease;
        }

        .result-section.show {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        . result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom:  2px solid #E2E8F0;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .result-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #0EA5E9;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        . result-currency {
            font-size: 0.75rem;
            color: #94A3B8;
            font-weight: 600;
            background: #EEF2FF;
            padding: 0.3rem 0.6rem;
            border-radius:  0.3rem;
        }

        .core-result {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .core-item {
            background: linear-gradient(135deg, #EEF2FF 0%, #F0EDFF 100%);
            padding: 1rem;
            border-radius: 0.8rem;
            text-align: center;
            border: 1px solid rgba(67, 56, 202, 0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .core-item:: before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width:  60px;
            height: 60px;
            background: linear-gradient(135deg, rgba(67, 56, 202, 0.1), transparent);
            border-radius: 50%;
            pointer-events: none;
        }

        .core-item:hover {
            transform: translateY(-4px);
            box-shadow:  0 4px 12px rgba(67, 56, 202, 0.15);
        }

        .core-label {
            font-size: 0.73rem;
            color: #64748B;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .core-value {
            font-size: 1.3rem;
            font-weight:  800;
            margin-top: 0.4rem;
            font-variant-numeric: tabular-nums;
        }

        .core-value. profit {
            color: #10B981;
            text-shadow: 0 2px 4px rgba(16, 185, 129, 0.1);
        }

        .core-value.loss {
            color: #EF4444;
            text-shadow:  0 2px 4px rgba(239, 68, 68, 0.1);
        }

        .detail-result {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.8rem;
            margin-bottom: 1rem;
        }

        .detail-item {
            background: linear-gradient(135deg, #F8FAFC 0%, #F1F5F9 100%);
            padding:  0.8rem;
            border-radius: 0.6rem;
            border-left: 3px solid #4338CA;
            transition: all 0.2s ease;
        }

        .detail-item:hover {
            transform: translateX(4px);
            box-shadow:  0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .detail-label {
            font-size: 0.7rem;
            color: #94A3B8;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .detail-value {
            font-size: 0.8rem;
            font-weight:  700;
            margin-top: 0.3rem;
            color: #1E293B;
            font-variant-numeric: tabular-nums;
        }

        .note-box {
            background: linear-gradient(135deg, #FFFBEB 0%, #FEF3C7 100%);
            border-left: 3px solid #F59E0B;
            padding:  0.8rem 0. 9rem;
            border-radius: 0 0.6rem 0.6rem 0;
            margin-top: 1rem;
            font-size: 0.72rem;
            color: #78350F;
            line-height: 1.5;
            font-weight: 500;
            border:  1px solid rgba(245, 158, 11, 0.2);
        }

        . note-box i {
            color: #F59E0B;
            margin-right: 0.3rem;
        }

        /* ===== é¡µè„š ===== */
        . mwe-footer {
            text-align: center;
            margin-top: 1. 5rem;
            font-size: 0.7rem;
            color: #94A3B8;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            flex-wrap: wrap;
            font-weight: 500;
        }

        .mwe-logo {
            font-weight: 800;
            background: linear-gradient(135deg, #4338CA, #0EA5E9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.05em;
            font-size: 0.8rem;
        }

        /* ===== å“åº”å¼è®¾è®¡ ===== */
        @media (min-width: 577px) and (max-width: 768px) {
            .container {
                max-width: 95%;
            }

            .selector-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .input-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .detail-result {
                grid-template-columns: repeat(3, 1fr);
            }

            .calc-header h1 . zh-title {
                font-size: 1.15rem;
            }
        }

        @media (max-width: 576px) {
            body {
                padding: 0.75rem;
            }

            . container {
                max-width: 100%;
            }

            . calc-header {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .lang-switch {
                position: relative;
                top: auto;
                right: auto;
                margin:  0 auto 0.8rem auto;
                display: inline-flex;
            }

            .selector-grid {
                grid-template-columns: 1fr;
                gap: 0.6rem;
            }

            . input-grid {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }

            . detail-result {
                grid-template-columns: repeat(2, 1fr);
            }

            .btn-group {
                flex-direction: column;
                gap: 0.6rem;
            }

            . calc-btn {
                width:  100%;
                height: 2.6rem;
            }

            .calc-header h1 .zh-title {
                font-size: 1.1rem;
            }

            . feature-tags {
                gap: 0.5rem;
            }

            . feature-tag {
                font-size: 0.7rem;
            }

            .core-result {
                grid-template-columns: 1fr;
            }

            .base-selector,
            .calc-section {
                padding: 1rem;
                margin-bottom: 0.8rem;
            }

            .result-section {
                padding: 1rem;
            }
        }

        @media (max-width: 400px) {
            body {
                padding: 0.5rem;
            }

            .calc-header h1 .zh-title {
                font-size: 1rem;
            }

            .mwe-badge {
                font-size: 0.6rem;
                padding: 0.1rem 0.4rem;
            }

            .detail-result {
                grid-template-columns: 1fr;
            }

            .selector-item . item-label {
                font-size: 0.7rem;
            }

            . selector-input {
                height: 2.4rem;
                padding: 0.6rem 2. 2rem 0.6rem 0.5rem;
            }

            . form-input {
                height: 2.4rem;
                padding: 0.6rem 2.2rem 0.6rem 0.5rem;
            }

            .core-value {
                font-size: 1.1rem;
            }
        }

        @media (orientation: landscape) and (max-height: 500px) {
            body {
                padding: 0.5rem;
            }

            .container {
                max-width: 100%;
            }

            . base-selector,
            .calc-section {
                padding: 0.8rem;
                margin-bottom: 0.6rem;
            }

            . selector-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }

            . input-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.6rem;
            }

            .form-input,
            .selector-input {
                height: 2.2rem;
                padding: 0.4rem 1.8rem 0.4rem 0.5rem;
                font-size: 0.75rem;
            }

            . calc-btn {
                height: 2.3rem;
                padding: 0.4rem 0;
                font-size: 0.75rem;
            }

            . btn-group {
                margin:  0.5rem 0 0.6rem 0;
                gap: 0.5rem;
            }

            . section-title {
                margin-bottom: 0.6rem;
            }

            .section-header . title {
                font-size:  0.85rem;
            }

            .calc-header {
                margin-bottom: 0.8rem;
                padding:  0.8rem;
            }

            .feature-tags {
                margin-bottom: 0.3rem;
            }
        }

        /* ===== æ‰“å°æ ·å¼ ===== */
        @media print {
            body {
                background: white;
            }

            .lang-switch,
            .btn-group {
                display: none;
            }

            .calc-section,
            .base-selector {
                page-break-inside: avoid;
                box-shadow: none;
            }
        }

        /* ===== æ·±è‰²æ¨¡å¼æ”¯æŒ ===== */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                color: #e2e8f0;
            }

            .calc-header,
            .base-selector,
            .calc-section,
            .result-section {
                background: #1e293b;
                border-color: #334155;
            }

            . calc-header: hover,
            .base-selector:hover,
            .calc-section:hover {
                border-color: #475569;
            }

            . selector-input,
            .form-input {
                background: #334155;
                border-color: #475569;
                color: #e2e8f0;
            }

            . selector-input:hover,
            .form-input:hover {
                background: #475569;
            }

            .feature-tag {
                background: rgba(67, 56, 202, 0.15);
            }

            .core-item {
                background: rgba(67, 56, 202, 0.1);
            }

            .detail-item {
                background: #334155;
            }

            . lang-switch {
                background: #1e293b;
                color: #e2e8f0;
            }
        }

        /* ===== æ— éšœç¢ç„¦ç‚¹æ ·å¼ ===== */
        *:focus-visible {
            outline: 2px solid #4338CA;
            outline-offset: 2px;
        }

        button:focus-visible {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }

        /* ===== åŠ è½½åŠ¨ç”» ===== */
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ï¼ˆå«è¯­è¨€åˆ‡æ¢ï¼‰ -->
        <div class="calc-header">
            <button class="lang-switch" id="langSwitch" aria-label="åˆ‡æ¢è¯­è¨€" title="Toggle Language">
                <span id="langText">EN</span>
                <i class="fa fa-language" aria-hidden="true"></i>
            </button>
            <h1 data-lang-key="title">
                <div class="zh-title">
                    å¤šå¸ç§æƒè¯æ”¶ç›Šä¼°ç®—å™¨
                    <span class="mwe-badge" aria-label="MWE å®˜æ–¹åº”ç”¨">MWE</span>
                </div>
                <div class="en-title" data-lang-key="enTitle">Multi-currency Warrant Yield Estimator</div>
            </h1>

            <!-- ç‰¹æ€§æ ‡ç­¾ -->
            <div class="feature-tags" data-lang-key="features" role="list">
                <div class="feature-tag" role="listitem">
                    <i class="fa fa-globe" aria-hidden="true"></i>
                    <span data-lang-key="multiCurrency">å¤šå¸ç§</span>
                </div>
                <div class="feature-tag" role="listitem">
                    <i class="fa fa-refresh" aria-hidden="true"></i>
                    <span data-lang-key="realTimeRate">å®æ—¶æ±‡ç‡</span>
                </div>
                <div class="feature-tag" role="listitem">
                    <i class="fa fa-bolt" aria-hidden="true"></i>
                    <span data-lang-key="simpleOperation">ç®€æ˜“æ“ä½œ</span>
                </div>
            </div>
        </div>

        <!-- åŸºç¡€é€‰å‹åŒº -->
        <div class="base-selector" role="region" aria-label="åŸºç¡€è®¾ç½®">
            <div class="section-title" data-lang-key="baseSelectorTitle">
                <i class="fa fa-sliders" aria-hidden="true"></i>
                <span data-lang-key="basicSettings">åŸºç¡€è®¾ç½®</span>
            </div>
            <div class="selector-grid">
                <div class="selector-item">
                    <label class="item-label" for="warrantType">
                        <i class="fa fa-tag" aria-hidden="true"></i>
                        <span data-lang-key="warrantTypeLabel">æƒè¯ç±»å‹</span>
                    </label>
                    <select id="warrantType" class="selector-input" aria-label="æƒè¯ç±»å‹">
                        <option value="call" data-lang-key="callOption">è®¤è´­ï¼ˆç‰›è¯ï¼‰</option>
                        <option value="put" data-lang-key="putOption">è®¤æ²½ï¼ˆç†Šè¯ï¼‰</option>
                    </select>
                </div>
                <div class="selector-item">
                    <label class="item-label" for="warrantCurrency">
                        <i class="fa fa-money" aria-hidden="true"></i>
                        <span data-lang-key="settleCurrencyLabel">ç»“ç®—å¸ç§</span>
                    </label>
                    <select id="warrantCurrency" class="selector-input" aria-label="ç»“ç®—å¸ç§">
                        <option value="SGD">SGD</option>
                        <option value="USD">USD</option>
                        <option value="HKD">HKD</option>
                    </select>
                </div>
                <div class="selector-item">
                    <label class="item-label" for="stockCurrency">
                        <i class="fa fa-line-chart" aria-hidden="true"></i>
                        <span data-lang-key="stockCurrencyLabel">æ­£è‚¡å¸ç§</span>
                    </label>
                    <select id="stockCurrency" class="selector-input" aria-label="æ­£è‚¡å¸ç§">
                        <option value="USD">USD</option>
                        <option value="HKD">HKD</option>
                        <option value="SGD">SGD</option>
                    </select>
                </div>
            </div>
            <div class="rate-update-hint" role="status" aria-live="polite">
                <div>
                    <i class="fa fa-clock-o" aria-hidden="true"></i>
                    <span data-lang-key="rateUpdateHint">æ±‡ç‡æ›´æ–°</span>
                </div>
                <div class="rate-time" id="rateUpdateTime">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- æ ¸å¿ƒè¾“å…¥åŒº -->
        <div class="calc-section" role="region" aria-label="æ ¸å¿ƒè¾“å…¥">
            <div class="section-header" onclick="toggleSection('coreInput')" role="button" tabindex="0" aria-expanded="true" aria-controls="coreInputContent">
                <div class="title" style="color: #10B981;" data-lang-key="coreInputTitle">
                    <i class="fa fa-pencil" aria-hidden="true"></i>
                    <span data-lang-key="coreInput">æ ¸å¿ƒè¾“å…¥</span>
                </div>
                <div class="toggle-btn" data-lang-key="collapseBtn">
                    <i class="fa fa-minus" aria-hidden="true"></i>
                    <span data-lang-key="collapse">æ”¶èµ·</span>
                </div>
            </div>
            <div class="section-content expanded" id="coreInputContent">
                <div class="input-grid">
                    <div class="input-group">
                        <label class="input-label" for="conversionRatio" data-lang-key="conversionRatioLabel">
                            <i class="fa fa-exchange" aria-hidden="true"></i> æ¢è‚¡æ¯”ç‡
                        </label>
                        <input type="number" id="conversionRatio" step="1" value="25" class="form-input no-currency" inputmode="decimal" aria-label="æ¢è‚¡æ¯”ç‡">
                        <div class="input-hint" data-lang-key="conversionRatioHint">1æ­£è‚¡å¯¹åº”æƒè¯ä»½æ•°</div>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="warrantPrice" data-lang-key="warrantPriceLabel">
                            <i class="fa fa-ticket" aria-hidden="true"></i> æƒè¯ç°ä»·
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="warrantPrice" step="0.001" value="0. 049" class="form-input" placeholder="0.000" inputmode="decimal" aria-label="æƒè¯ç°ä»·">
                            <span class="currency-tag" id="warrantPriceTag" aria-hidden="true">SGD</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="currentStockPrice" data-lang-key="currentStockPriceLabel">
                            <i class="fa fa-line-chart" aria-hidden="true"></i> æ­£è‚¡ç°ä»·
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="currentStockPrice" step="0.01" value="61.50" class="form-input" placeholder="0.00" inputmode="decimal" aria-label="æ­£è‚¡ç°ä»·">
                            <span class="currency-tag" id="currentStockPriceTag" aria-hidden="true">USD</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="targetStockPrice" data-lang-key="targetStockPriceLabel">
                            <i class="fa fa-bullseye" aria-hidden="true"></i> æ­£è‚¡ç›®æ ‡ä»·
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="targetStockPrice" step="0.01" value="138.50" class="form-input" placeholder="0.00" inputmode="decimal" aria-label="æ­£è‚¡ç›®æ ‡ä»·">
                            <span class="currency-tag" id="targetStockPriceTag" aria-hidden="true">USD</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="holdAmount" data-lang-key="holdAmountLabel">
                            <i class="fa fa-database" aria-hidden="true"></i> æŒæœ‰ä»½æ•°
                        </label>
                        <input type="number" id="holdAmount" step="100" value="1000" class="form-input no-currency" placeholder="0" inputmode="decimal" aria-label="æŒæœ‰ä»½æ•°">
                    </div>
                </div>
            </div>
        </div>

        <!-- é«˜çº§å‚æ•°åŒº -->
        <div class="calc-section" role="region" aria-label="é«˜çº§å‚æ•°">
            <div class="section-header" onclick="toggleSection('advancedInput')" role="button" tabindex="0" aria-expanded="false" aria-controls="advancedInputContent">
                <div class="title" style="color: #F59E0B;" data-lang-key="advancedInputTitle">
                    <i class="fa fa-cog" aria-hidden="true"></i>
                    <span data-lang-key="advancedInput">é«˜çº§å‚æ•°</span>
                </div>
                <div class="toggle-btn" data-lang-key="expandBtn">
                    <i class="fa fa-plus" aria-hidden="true"></i>
                    <span data-lang-key="expand">å±•å¼€</span>
                </div>
            </div>
            <div class="section-content" id="advancedInputContent">
                <div class="input-grid">
                    <div class="input-group">
                        <label class="input-label" for="strikePrice" data-lang-key="strikePriceLabel">
                            <i class="fa fa-bullseye" aria-hidden="true"></i> æ­£è‚¡è¡Œæƒä»·
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="strikePrice" step="0.01" value="60. 00" class="form-input" placeholder="0.00" inputmode="decimal" aria-label="æ­£è‚¡è¡Œæƒä»·">
                            <span class="currency-tag" id="strikePriceTag" aria-hidden="true">USD</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="feeRate" data-lang-key="feeRateLabel">
                            <i class="fa fa-percent" aria-hidden="true"></i> äº¤æ˜“è´¹ç‡(%)
                        </label>
                        <input type="number" id="feeRate" step="0.01" value="0.3" class="form-input no-currency" placeholder="0.00" inputmode="decimal" aria-label="äº¤æ˜“è´¹ç‡">
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="expireDate" data-lang-key="expireDateLabel">
                            <i class="fa fa-calendar" aria-hidden="true"></i> åˆ°æœŸæ—¥
                        </label>
                        <input type="date" id="expireDate" class="form-input no-currency" aria-label="åˆ°æœŸæ—¥">
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="volatility" data-lang-key="volatilityLabel">
                            <i class="fa fa-random" aria-hidden="true"></i> æ³¢åŠ¨ç‡(%)
                        </label>
                        <input type="number" id="volatility" step="0.1" value="20. 0" class="form-input no-currency" placeholder="20.0" inputmode="decimal" aria-label="æ³¢åŠ¨ç‡">
                        <div class="input-hint" data-lang-key="volatilityHint">æ— æ•°æ®å¡«20-30%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½æŒ‰é’®ç»„ -->
        <div class="btn-group">
            <button id="calculateBtn" class="calc-btn btn-primary" data-lang-key="calculateBtn" aria-label="è®¡ç®—æ”¶ç›Š">
                <i class="fa fa-calculator" aria-hidden="true"></i>
                <span data-lang-key="calculate">è®¡ç®—æ”¶ç›Š</span>
            </button>
            <button id="resetBtn" class="calc-btn btn-secondary" data-lang-key="resetBtn" aria-label="é‡ç½®è¡¨å•">
                <i class="fa fa-refresh" aria-hidden="true"></i>
                <span data-lang-key="reset">é‡ç½®</span>
            </button>
        </div>

        <!-- ç»“æœå±•ç¤ºåŒº -->
        <div id="resultArea" class="result-section" role="region" aria-label="è®¡ç®—ç»“æœ" aria-live="polite">
            <div class="result-header">
                <div class="result-title" data-lang-key="resultTitle">
                    <i class="fa fa-chart-pie" aria-hidden="true"></i>
                    <span data-lang-key="result">è®¡ç®—ç»“æœ</span>
                </div>
                <div class="result-currency" data-lang-key="resultCurrency">
                    <span id="resultCurrency">SGD</span>
                </div>
            </div>
            <div class="core-result">
                <div class="core-item">
                    <div class="core-label" data-lang-key="profitRateLabel">æŠ•èµ„æ”¶ç›Šç‡</div>
                    <div class="core-value profit" id="profitRate" aria-live="assertive">0.00%</div>
                </div>
                <div class="core-item">
                    <div class="core-label" data-lang-key="totalProfitLabel">ç›®æ ‡æ€»æ”¶ç›Š</div>
                    <div class="core-value profit" id="totalProfit" aria-live="assertive">0.00 SGD</div>
                </div>
            </div>
            <div class="detail-result">
                <div class="detail-item">
                    <div class="detail-label" data-lang-key="convertedCurrentPriceLabel">æ­£è‚¡ç°ä»·(æ¢ç®—)</div>
                    <div class="detail-value" id="convertedCurrentStockPrice">0.00</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label" data-lang-key="convertedTargetPriceLabel">ç›®æ ‡ä»·(æ¢ç®—)</div>
                    <div class="detail-value" id="convertedTargetStockPrice">0.00</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label" data-lang-key="totalCostLabel">æƒè¯æˆæœ¬</div>
                    <div class="detail-value" id="totalCost">0.00</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label" data-lang-key="stockQuantityLabel">å¯¹åº”æ­£è‚¡æ•°</div>
                    <div class="detail-value" id="stockQuantity">0.00</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label" data-lang-key="intrinsicValueLabel">å†…åœ¨ä»·å€¼</div>
                    <div class="detail-value" id="intrinsicValue">0.000</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label" data-lang-key="remainingDaysLabel">å‰©ä½™å¤©æ•°</div>
                    <div class="detail-value" id="remainingDays">0</div>
                </div>
            </div>
            <div class="note-box" data-lang-key="noteText">
                <i class="fa fa-info-circle" aria-hidden="true"></i>
                <span data-lang-key="note">MWE - è·¨å¸ç§è‡ªåŠ¨æ¢ç®—ï¼Œç»“æœä»…ä¾›å‚è€ƒï¼›å®é™…æ”¶ç›Šå—æ±‡ç‡ã€å¸‚åœºæƒ…ç»ªå½±å“ã€‚</span>
            </div>
        </div>

        <!-- MWEé¡µè„š -->
        <div class="mwe-footer">
            <span>Â© 2026</span>
            <span class="mwe-logo">MWE</span>
            <span data-lang-key="footerText">å¤šå¸ç§æƒè¯æ”¶ç›Šä¼°ç®—å™¨</span>
            <span>â€¢</span>
            <span data-lang-key="version">v1.3</span>
        </div>
    </div>

    <script>
        // ===== è¯­è¨€é…ç½® =====
        const LANGS = {
            zh:  {
                title: "å¤šå¸ç§æƒè¯æ”¶ç›Šä¼°ç®—å™¨",
                enTitle: "Multi-currency Warrant Yield Estimator",
                multiCurrency: "å¤šå¸ç§",
                realTimeRate: "å®æ—¶æ±‡ç‡",
                simpleOperation:  "ç®€æ˜“æ“ä½œ",
                basicSettings: "åŸºç¡€è®¾ç½®",
                baseSelectorTitle: "åŸºç¡€è®¾ç½®",
                warrantTypeLabel: "æƒè¯ç±»å‹",
                callOption: "è®¤è´­ï¼ˆç‰›è¯ï¼‰",
                putOption: "è®¤æ²½ï¼ˆç†Šè¯ï¼‰",
                settleCurrencyLabel: "ç»“ç®—å¸ç§",
                stockCurrencyLabel: "æ­£è‚¡å¸ç§",
                rateUpdateHint: "æ±‡ç‡æ›´æ–°",
                coreInputTitle: "æ ¸å¿ƒè¾“å…¥",
                coreInput: "æ ¸å¿ƒè¾“å…¥",
                collapseBtn: "æ”¶èµ·",
                collapse: "æ”¶èµ·",
                conversionRatioLabel: "æ¢è‚¡æ¯”ç‡",
                conversionRatioHint: "1æ­£è‚¡å¯¹åº”æƒè¯ä»½æ•°",
                warrantPriceLabel: "æƒè¯ç°ä»·",
                currentStockPriceLabel: "æ­£è‚¡ç°ä»·",
                targetStockPriceLabel: "æ­£è‚¡ç›®æ ‡ä»·",
                holdAmountLabel: "æŒæœ‰ä»½æ•°",
                advancedInputTitle: "é«˜çº§å‚æ•°",
                advancedInput: "é«˜çº§å‚æ•°",
                expandBtn: "å±•å¼€",
                expand: "å±•å¼€",
                strikePriceLabel: "æ­£è‚¡è¡Œæƒä»·",
                feeRateLabel: "äº¤æ˜“è´¹ç‡(%)",
                expireDateLabel:  "åˆ°æœŸæ—¥",
                volatilityLabel: "æ³¢åŠ¨ç‡(%)",
                volatilityHint: "æ— æ•°æ®å¡«20-30%",
                calculateBtn: "è®¡ç®—æ”¶ç›Š",
                calculate: "è®¡ç®—æ”¶ç›Š",
                resetBtn: "é‡ç½®",
                reset: "é‡ç½®",
                resultTitle: "è®¡ç®—ç»“æœ",
                result: "è®¡ç®—ç»“æœ",
                resultCurrency: "ç»“ç®—å¸ç§ï¼š",
                profitRateLabel: "æŠ•èµ„æ”¶ç›Šç‡",
                totalProfitLabel:  "ç›®æ ‡æ€»æ”¶ç›Š",
                convertedCurrentPriceLabel: "æ­£è‚¡ç°ä»·(æ¢ç®—)",
                convertedTargetPriceLabel: "ç›®æ ‡ä»·(æ¢ç®—)",
                totalCostLabel: "æƒè¯æˆæœ¬",
                stockQuantityLabel: "å¯¹åº”æ­£è‚¡æ•°",
                intrinsicValueLabel:  "å†…åœ¨ä»·å€¼",
                remainingDaysLabel: "å‰©ä½™å¤©æ•°",
                note: "MWE - è·¨å¸ç§è‡ªåŠ¨æ¢ç®—ï¼Œç»“æœä»…ä¾›å‚è€ƒï¼›å®é™…æ”¶ç›Šå—æ±‡ç‡ã€å¸‚åœºæƒ…ç»ªå½±å“ã€‚",
                noteText: "note",
                footerText: "å¤šå¸ç§æƒè¯æ”¶ç›Šä¼°ç®—å™¨",
                version: "v1.3"
            },
            en: {
                title: "Multi-currency Warrant Yield Estimator",
                enTitle: "Multi-currency Warrant Yield Estimator",
                multiCurrency: "Multi-currency",
                realTimeRate: "Real-time Rate",
                simpleOperation:  "Simple Operation",
                basicSettings: "Basic Settings",
                baseSelectorTitle: "Basic Settings",
                warrantTypeLabel: "Warrant Type",
                callOption: "Call (Bull)",
                putOption: "Put (Bear)",
                settleCurrencyLabel: "Settlement Currency",
                stockCurrencyLabel: "Stock Currency",
                rateUpdateHint: "Rate Updated",
                coreInputTitle:  "Core Input",
                coreInput: "Core Input",
                collapseBtn: "Collapse",
                collapse: "Collapse",
                conversionRatioLabel: "Conversion Ratio",
                conversionRatioHint: "Warrants per 1 stock",
                warrantPriceLabel: "Warrant Price",
                currentStockPriceLabel: "Stock Price",
                targetStockPriceLabel: "Target Price",
                holdAmountLabel:  "Hold Amount",
                advancedInputTitle: "Advanced",
                advancedInput: "Advanced",
                expandBtn: "Expand",
                expand: "Expand",
                strikePriceLabel: "Strike Price",
                feeRateLabel:  "Fee Rate(%)",
                expireDateLabel:  "Expiry Date",
                volatilityLabel: "Volatility(%)",
                volatilityHint: "Fill 20-30% if no data",
                calculateBtn:  "Calculate",
                calculate: "Calculate",
                resetBtn: "Reset",
                reset: "Reset",
                resultTitle: "Results",
                result: "Results",
                resultCurrency: "Currency:",
                profitRateLabel:  "Return Rate",
                totalProfitLabel: "Total Profit",
                convertedCurrentPriceLabel: "Stock Price(Converted)",
                convertedTargetPriceLabel: "Target(Converted)",
                totalCostLabel: "Total Cost",
                stockQuantityLabel: "Stock Qty",
                intrinsicValueLabel: "Intrinsic Value",
                remainingDaysLabel:  "Days Left",
                note: "MWE - Auto currency conversion, results for reference only.",
                noteText: "note",
                footerText: "Multi-currency Warrant Estimator",
                version: "v1.3"
            }
        };

        let currentLang = "zh";

        // ===== è¯­è¨€åˆ‡æ¢ =====
        function switchLanguage() {
            currentLang = currentLang === "zh" ? "en" : "zh";
            document.getElementById("langText").textContent = currentLang === "zh" ? "EN" : "ZH";
            document. documentElement.lang = currentLang;

            document.querySelectorAll("[data-lang-key]").forEach(el => {
                const key = el.getAttribute("data-lang-key");
                if (LANGS[currentLang][key]) {
                    if (el.tagName === "OPTION" || el.tagName === "SPAN") {
                        el.textContent = LANGS[currentLang][key];
                    }
}            });
            updateToggleBtnText();
        }

        // ===== æ›´æ–°æŠ˜å æŒ‰é’®æ–‡å­— =====
        function updateToggleBtnText() {
            const coreToggle = document.querySelector('[onclick="toggleSection(\'coreInput\')"] .toggle-btn');
            const advancedToggle = document.querySelector('[onclick="toggleSection(\'advancedInput\')"] .toggle-btn');
            
            if (! coreToggle || !advancedToggle) return;
            
            const coreExpanded = document.getElementById("coreInputContent").classList.contains("expanded");
            const advancedExpanded = document. getElementById("advancedInputContent").classList.contains("expanded");
            
            coreToggle.innerHTML = coreExpanded
                ? `<i class="fa fa-minus"></i> ${LANGS[currentLang]. collapse}`
                : `<i class="fa fa-plus"></i> ${LANGS[currentLang].expand}`;
            
            advancedToggle.innerHTML = advancedExpanded
                ? `<i class="fa fa-minus"></i> ${LANGS[currentLang].collapse}`
                : `<i class="fa fa-plus"></i> ${LANGS[currentLang].expand}`;
        }

        // ===== æ±‡ç‡æ•°æ® =====
        let CURRENCY_RATES = {
            SGD: { USD: 0.74, HKD: 5.80, SGD: 1.0 },
            USD: { SGD: 1.35, HKD: 7.82, USD: 1.0 },
            HKD: { SGD: 0.17, USD: 0.13, HKD: 1.0 }
        };

        // ===== è·å–å®æ—¶æ±‡ç‡ =====
        async function fetchRealTimeRates() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString(currentLang === "zh" ? "zh-CN" : "en-US");
            document.getElementById('rateUpdateTime').textContent = timeStr;
            
            try {
                const response = await Promise.race([
                    fetch('https://api.exchangerate.host/latest? base=USD'),
                    new Promise((_, reject) => setTimeout(() => reject(new Error('timeout')), 5000))
                ]);
                
                if (response && response.ok) {
                    const data = await response.json();
                    if (data.rates && data.rates. SGD && data.rates.HKD) {
                        CURRENCY_RATES = {
                            SGD: { 
                                USD: +(1 / data.rates.SGD).toFixed(4),
                                HKD: +(data.rates.HKD / data.rates.SGD).toFixed(4),
                                SGD: 1.0 
                            },
                            USD: { 
                                SGD: +data.rates.SGD.toFixed(4),
                                HKD: +data.rates. HKD.toFixed(4),
                                USD: 1.0 
                            },
                            HKD: { 
                                SGD: +(data.rates.SGD / data.rates.HKD).toFixed(4),
                                USD: +(1 / data.rates.HKD).toFixed(4),
                                HKD: 1.0 
                            }
                        };
                    }
                }
            } catch (error) {
                console.log('ä½¿ç”¨é»˜è®¤æ±‡ç‡');
            }
        }

        // ===== æŠ˜å /å±•å¼€åŒºå— =====
        function toggleSection(sectionId) {
            const content = document.getElementById(`${sectionId}Content`);
            const header = content.previousElementSibling;
            const isExpanded = content.classList.toggle('expanded');
            
            // æ›´æ–° aria-expanded å±æ€§
            header.setAttribute('aria-expanded', isExpanded);
            
            const toggleBtn = header.querySelector('.toggle-btn');
            if (toggleBtn) {
                toggleBtn. innerHTML = isExpanded
                    ? `<i class="fa fa-minus"></i> ${LANGS[currentLang].collapse}`
                    : `<i class="fa fa-plus"></i> ${LANGS[currentLang].expand}`;
            }
        }

        // ===== æ›´æ–°å¸ç§æ ‡ç­¾ =====
        function updateCurrencyTags() {
            const warrantCurrency = document.getElementById('warrantCurrency').value;
            const stockCurrency = document.getElementById('stockCurrency').value;
            
            document.getElementById('warrantPriceTag').textContent = warrantCurrency;
            document.getElementById('strikePriceTag').textContent = stockCurrency;
            document.getElementById('currentStockPriceTag').textContent = stockCurrency;
            document.getElementById('targetStockPriceTag').textContent = stockCurrency;
            document.getElementById('resultCurrency').textContent = warrantCurrency;
        }

        // ===== è®¡ç®—å‰©ä½™å¤©æ•° =====
        function getRemainingDays(expireDateStr) {
            if (!expireDateStr) return 0;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const expireDate = new Date(expireDateStr);
            expireDate.setHours(0, 0, 0, 0);
            const diff = expireDate. getTime() - today.getTime();
            return Math.max(Math.ceil(diff / (1000 * 3600 * 24)), 0);
        }

        // ===== è®¡ç®—æ—¶é—´ä»·å€¼ =====
        function calculateTimeValue(stockPriceSettled, volatility, remainingDays, conversionRatio) {
            if (!remainingDays || !volatility || volatility === 0) return 0;
            const sqrtT = Math.sqrt(remainingDays / 365);
            return (volatility / 100 * stockPriceSettled * sqrtT) / conversionRatio;
        }

        // ===== éªŒè¯è¾“å…¥ =====
        function validateInputs() {
            const inputs = [
                { id: 'warrantPrice', name: 'æƒè¯ç°ä»·', min: 0 },
                { id: 'currentStockPrice', name: 'æ­£è‚¡ç°ä»·', min: 0 },
                { id: 'targetStockPrice', name:  'æ­£è‚¡ç›®æ ‡ä»·', min: 0 },
                { id:  'strikePrice', name: 'æ­£è‚¡è¡Œæƒä»·', min: 0 },
                { id: 'conversionRatio', name: 'æ¢è‚¡æ¯”ç‡', min: 1 },
                { id: 'holdAmount', name: 'æŒæœ‰ä»½æ•°', min: 0 },
                { id: 'feeRate', name: 'äº¤æ˜“è´¹ç‡', min: 0, max: 100 },
                { id: 'volatility', name: 'æ³¢åŠ¨ç‡', min: 0, max: 500 }
            ];

            for (const input of inputs) {
                const el = document.getElementById(input.id);
                const value = parseFloat(el.value);
                
                if (isNaN(value) || value < (input.min || 0)) {
                    alert(`${input.name}ä¸èƒ½ä¸ºç©ºæˆ–å°äº${input.min || 0}`);
                    el.focus();
                    return false;
                }
                
                if (input.max && value > input.max) {
                    alert(`${input.name}ä¸èƒ½è¶…è¿‡${input.max}`);
                    el.focus();
                    return false;
                }
            }
            
            if (! document.getElementById('expireDate').value) {
                alert('è¯·é€‰æ‹©åˆ°æœŸæ—¥');
                document.getElementById('expireDate').focus();
                return false;
            }
            
            return true;
        }

        // ===== æ ¸å¿ƒè®¡ç®—é€»è¾‘ =====
        function performCalculation() {
            if (!validateInputs()) return;

            const warrantType = document.getElementById('warrantType').value;
            const warrantCurrency = document.getElementById('warrantCurrency').value;
            const stockCurrency = document.getElementById('stockCurrency').value;

            const warrantPrice = parseFloat(document.getElementById('warrantPrice').value);
            const strikePrice = parseFloat(document. getElementById('strikePrice').value);
            const conversionRatio = parseFloat(document.getElementById('conversionRatio').value);
            const holdAmount = parseFloat(document.getElementById('holdAmount').value);
            const currentStockPrice = parseFloat(document.getElementById('currentStockPrice').value);
            const targetStockPrice = parseFloat(document.getElementById('targetStockPrice').value);
            const feeRate = parseFloat(document. getElementById('feeRate').value) / 100;
            const volatility = parseFloat(document.getElementById('volatility').value);
            const expireDateStr = document.getElementById('expireDate').value;

            // æ±‡ç‡è½¬æ¢
            const rate = CURRENCY_RATES[stockCurrency][warrantCurrency];
            const strikePriceSettled = strikePrice * rate;
            const currentStockPriceSettled = currentStockPrice * rate;
            const targetStockPriceSettled = targetStockPrice * rate;

            // è®¡ç®—å…³é”®æŒ‡æ ‡
            const remainingDays = getRemainingDays(expireDateStr);
            const stockQuantity = holdAmount / conversionRatio;
            
            const intrinsicValue = Math.max(
                warrantType === 'call' 
                    ? (targetStockPriceSettled - strikePriceSettled) / conversionRatio 
                    : (strikePriceSettled - targetStockPriceSettled) / conversionRatio,
                0
            );
            
            const timeValue = calculateTimeValue(currentStockPriceSettled, volatility, remainingDays, conversionRatio);
            const theoreticalPrice = intrinsicValue + timeValue;

            const totalCost = holdAmount * warrantPrice * (1 + feeRate);
            const totalRevenue = holdAmount * theoreticalPrice * (1 - feeRate);
            const totalProfit = totalRevenue - totalCost;
            const profitRate = totalCost > 0 ? (totalProfit / totalCost) * 100 : 0;

            // æ›´æ–°ç»“æœæ˜¾ç¤º
            const unit = warrantCurrency;
            document.getElementById('convertedCurrentStockPrice').textContent = `${currentStockPriceSettled. toFixed(2)} ${unit}`;
            document.getElementById('convertedTargetStockPrice').textContent = `${targetStockPriceSettled.toFixed(2)} ${unit}`;
            document.getElementById('totalCost').textContent = `${totalCost.toFixed(2)} ${unit}`;
            document.getElementById('stockQuantity').textContent = `${stockQuantity.toFixed(2)}`;
            document.getElementById('intrinsicValue').textContent = `${intrinsicValue.toFixed(3)} ${unit}`;
            document.getElementById('remainingDays').textContent = `${remainingDays}`;
            document.getElementById('totalProfit').textContent = `${totalProfit.toFixed(2)} ${unit}`;
            document.getElementById('profitRate').textContent = `${profitRate.toFixed(2)}%`;

            // æ›´æ–°é¢œè‰²
            const profitEl = document.getElementById('totalProfit');
            const rateEl = document.getElementById('profitRate');
            
            if (totalProfit >= 0) {
                profitEl.className = 'core-value profit';
                rateEl.className = 'core-value profit';
            } else {
                profitEl.className = 'core-value loss';
                rateEl.className = 'core-value loss';
            }

            // æ˜¾ç¤ºç»“æœ
            document.getElementById('resultArea').classList.add('show');
            
            // æ»šåŠ¨åˆ°ç»“æœ
            setTimeout(() => {
                document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        // ===== è®¡ç®—æŒ‰é’®äº‹ä»¶ =====
        document. getElementById('calculateBtn').addEventListener('click', performCalculation);
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && ! e.shiftKey) {
                performCalculation();
            }
        });

        // ===== é‡ç½®åŠŸèƒ½ =====
        function resetForm() {
            // é‡ç½®æ‰€æœ‰è¾“å…¥
            document.querySelectorAll('input').forEach(input => {
                if (input.type === 'date') {
                    const defaultDate = new Date();
                    defaultDate.setDate(defaultDate.getDate() + 30);
                    input.valueAsDate = defaultDate;
                } else {
                    input.value = input.defaultValue || '';
                }
            });

            document.querySelectorAll('select').forEach(select => {
                select.value = select.defaultValue || select.options[0].value;
            });

            updateCurrencyTags();
            
            const coreInput = document.getElementById('coreInputContent');
            const advancedInput = document.getElementById('advancedInputContent');
            
            coreInput.classList.add('expanded');
            advancedInput.classList.remove('expanded');
            
            const coreHeader = coreInput.previousElementSibling;
            const advHeader = advancedInput.previousElementSibling;
            
            coreHeader.setAttribute('aria-expanded', 'true');
            advHeader.setAttribute('aria-expanded', 'false');
            
            updateToggleBtnText();
            document.getElementById('resultArea').classList.remove('show');
        }

        document.getElementById('resetBtn').addEventListener('click', resetForm);

        // ===== åˆå§‹åŒ– =====
        window.addEventListener('load', () => {
            // è®¾ç½®é»˜è®¤åˆ°æœŸæ—¥
            const defaultDate = new Date();
            defaultDate. setDate(defaultDate.getDate() + 30);
            document.getElementById('expireDate').valueAsDate = defaultDate;
            
            // åˆå§‹åŒ–å¸ç§æ ‡ç­¾
            updateCurrencyTags();
            
            // è·å–æ±‡ç‡
            fetchRealTimeRates();
            
            // æ¯30åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡æ±‡ç‡
            setInterval(fetchRealTimeRates, 30 * 60 * 1000);
            
            // è¯­è¨€åˆ‡æ¢
            document.getElementById('langSwitch').addEventListener('click', switchLanguage);
            
            // å¸ç§å˜æ›´äº‹ä»¶
            document.getElementById('warrantCurrency').addEventListener('change', updateCurrencyTags);
            document.getElementById('stockCurrency').addEventListener('change', updateCurrencyTags);
            
            // é”®ç›˜å¯¼èˆªå¢å¼º
            document.querySelectorAll('[role="button"]').forEach(btn => {
                btn.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e. preventDefault();
                        btn.click();
                    }
                });
            });
        });
    </script>
</body>
</html>
